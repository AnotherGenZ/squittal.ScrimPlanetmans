@using squittal.ScrimPlanetmans.ScrimMatch.Models;

@if (_renderedStatsType != null && UseInfantryMatchReport())
{
    <InfantryMatchReport i_showHsr=i_showHsr i_statsType=(OverlayStatsDisplayType)_renderedStatsType i_compact=_renderedCompact />
}

@code {
    [Parameter]
    public bool i_showHsr { get; set; } = true;

    [Parameter]
    public bool i_compact { get; set; }
    private bool _renderedCompact { get; set; } = false;

    [Parameter]
    public OverlayStatsDisplayType i_statsType { get; set; }
    private OverlayStatsDisplayType? _renderedStatsType { get; set; }

    private OverlayStatsDisplayType _defaultStatsType = OverlayStatsDisplayType.InfantryScores;


    #region Initialization Methods
    protected override void OnParametersSet()
    {
        var stateHasChanged = false;

        if (_renderedCompact != i_compact)
        {
            _renderedCompact = i_compact;

            stateHasChanged = true;
        }

        if (_renderedStatsType != i_statsType)
        {
            _renderedStatsType = (i_statsType == OverlayStatsDisplayType.InfantryObjective) ? i_statsType : _defaultStatsType;

            stateHasChanged = true;
        }

        if (stateHasChanged)
        {
            InvokeAsyncStateHasChanged();
        }


    }
    #endregion Initialization Methods

    private bool UseInfantryMatchReport()
    {
        switch (_renderedStatsType)
        {
            case OverlayStatsDisplayType.InfantryScores:
                return true;

            case OverlayStatsDisplayType.InfantryObjective:
                return true;

            default:
                return false;
        }
    }

    private void InvokeAsyncStateHasChanged()
    {
        InvokeAsync(() =>
        {
            StateHasChanged();
        });
    }
}